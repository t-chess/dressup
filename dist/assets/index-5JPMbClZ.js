var t=Object.defineProperty;import{P as e}from"./phaser-CmFXOKba.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class i extends Phaser.Scene{constructor(){super("Loading")}preload(){this.load.setPath("assets"),this.add.sprite(640,480,"loadingBg").setPosition(320,240),this.add.panel(100,120,"md",11,2,24).setText("Gail's Sweet Homecoming"),this.add.panel(40,200,"md",14,3).setText("After spending a few years away from her hometown, 19-year-old Abigaïl is finally visiting to reunite with her mother. As they prepare for a memorable evening together, help them choose the perfect outfits to make this reunion even more special."),Array.from({length:4},((t,e)=>e+1)).forEach((t=>{this.load.image("bg"+t,"bg"+t+".png")})),Array.from({length:5},((t,e)=>e+1)).forEach((t=>{t>0&&this.load.image("cut"+t,"scenes/cut"+t+".png")})),this.load.audio("sea","scenes/sea.mp3"),this.load.audio("aggrolighter","scenes/aggrolighter.mp3"),this.load.audio("zippo","scenes/zippo.mp3"),this.load.audio("music","music.mp3"),this.load.atlas("bodies","bodies.png",{frames:[{filename:"mother",frame:{x:0,y:0,w:187,h:463}},{filename:"abigail",frame:{x:187,y:0,w:224,h:424}},{filename:"hand",frame:{x:187,y:424,w:87,h:39}},{filename:"eyes",frame:{x:274,y:424,w:59,h:39}}]}),this.load.spritesheet([{key:"momhair",frameConfig:{frameWidth:191,frameHeight:176}},{key:"momtop",frameConfig:{frameWidth:216,frameHeight:361}},{key:"mombottom",frameConfig:{frameWidth:220,frameHeight:237}},{key:"gailhair",frameConfig:{frameWidth:176,frameHeight:136}},{key:"gailtop",frameConfig:{frameWidth:236,frameHeight:325}},{key:"gailbottom",frameConfig:{frameWidth:222,frameHeight:193}}]),this.load.image("end1","end1.png"),this.load.image("end2","end2.png"),this.add.progressbar(void 0,320,void 0,(()=>this.scene.start("Intro"))),this.add.soundbutton()}}const s={preview:[{on:["mom","hair",6],text:["Ah, I wish I had curly hair"]},{on:["gail","top",5],text:["You won't mind if I borrow something from your closet, right? I didn't have space to bring much with me."]},{on:["gail","bottom",2],text:["I don't want to think anymore. Let's just finish this."]}],click:[{on:["mom","hair",4],text:["Isn't it a wonderful, bittersweet feeling, when people say we look so much alike?"]},{on:["mom","hair",2],text:["He liked my hair like this. Said I looked like a storybook girl."]},{on:["mom","hair",9],text:["This is where I feel closest to my old dreams - singing here in church.","It's not the stage I imagined but it's a stage nonetheless."]},{on:["mom","hair",11],text:["It's nice, isn't it? Almost like dressing up for something special."]},{on:["mom","top",3],text:["Do you have any idea what it's like to see your dreams die because of a single mistake?"]},{on:["mom","top",5],text:["There is no sin He cannot forgive.","No sin He cannot forgive."]},{on:["mom","top",6],text:["I gave up my entire future because of you, and look what I got in return."]},{on:["mom","top",9],text:["Meanwhile, think about your behavior in the basement."]},{on:["mom","bottom",2],text:["But I tried to love you, I really did."]},{on:["gail","hair",3],text:["I'm so afraid of looking at myself in the mirror someday and seeing your face staring back at me."]},{on:["gail","hair",5],text:["Mourning looks good on me, don't you think?"]},{on:["gail","top",6],text:["It's cold. Should've figured."]}],end1:['"Dear Abigaïl,',"I know these words will never reach you, and it's far too late to offer any apology, but I write them nonetheless, as a final confession.","The devil took hold of me, and I became everything a mother shouldn't be — a vessel of cruelty and bitterness, chained to the bottle and lost to my own despair.","From the day you were born, my hands, which should have offered comfort, instead brought pain, and for long years, that pain was all I gave you.","You were right to leave, and in truth, I never wanted you to stay.","I have confessed my sins and sought refuge in the Lord, though I fear His mercy is beyond my reach.","May God grant you the peace I never could.",'Mother"'],end2:['"Once upon a time, there lived a young maiden with a heart full of dreams, a voice more charming than the morning birds, and a spirit that radiated joy.',"Her melodies flowed like rivers, filling the air with vibrant energy and uplifting everyone who listened. Her voice was her treasure and the source of her greatest hopes.","One fateful day, a mysterious circus, with tents of deep crimson and gold, and performers who seemed to dance on the edge of reality itself, arrived at the town.","Among them was a dashing young man, a circus artist with eyes as sharp as a hawk's and a smile as fleeting as the wind.","He whispered promises of a shared future, bright, wild and free like the circus itself, of a life where her voice would be heard across the world.","But soon, the young maiden discovered she was with child, and the warmth in his eyes turned to ice. ","The once-charming whispers became distant echoes of lies, and as the season ended, the circus packed up and vanished into the mist,","leaving her behind without a word, like a fading dream. Her once-bright dreams crumbled into dust. ","As the life inside her grew, her voice dimmed, faltering until it became nothing more than a faint echo of what it once had been—a ghost haunting her from within.",'In the end, her voice was gone, and all that was left was a child born into the quiet void of her shattered dreams."']};class a extends Phaser.Scene{constructor(){var e;super("Main"),((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(this,"symbol"!=typeof(e="changePreview")?e+"":e,(t=>{this.sound.play("ui_click");const e=this.gameState.currentChar,i=this.gameState.currentSection,s=this.gameState[e][i+"preview"],a=this.gameState[e][i+"total"];this.previews[e+i+"b"].setVisible(!0),this.chooseBtn.setVisible(!1);let o="next"===t?s+2<a?s+2:0:0===s?a-2:s-2;"gail"===e&&"top"===i?("next"===t&&2===s?o=5:"prev"===t&&5===s&&(o=2),this.chooseBtn.setVisible(!this.gameState.gail.choice&&2===o),this.previews[e+i+"b"].setFrame(2===o?"winter"===this.gameState.gail.choice?3:4:o+1).setVisible(this.gameState.gail.choice||2!==o)):this.previews[e+i+"b"].setFrame(o+1),this.gameState[e][i+"preview"]=o,this.previews[e+i+"t"].setFrame(o),this.gameState.btnChangeChar||"bottom"!==i||0!==s||(this.arrowgail.setVisible(!0),this.gameState.btnChangeChar=!0),this.checkChange("preview")})),this.gameState={currentChar:"mom",currentSection:"",bg:0,bgtotal:4,mom:{hair:0,hairpreview:0,hairtotal:12,top:0,toppreview:0,toptotal:10,bottom:0,bottompreview:0,bottomtotal:6},gail:{hair:0,hairpreview:0,hairtotal:6,top:0,toppreview:0,toptotal:7,choice:null,bottom:0,bottompreview:0,bottomtotal:4}}}create(){Array.from({length:4},((t,e)=>e+1)).forEach((t=>{this["bg"+t]=this.add.sprite(640,480,"bg"+t).setVisible(!(t>1)).setPosition(320,240)})),this.dump=this.add.group(),this.hairbtn=this.add.panel(20,100,"md",3,2,20).setText("Hair").onClick((()=>{this.onNavClicked("hair")})),this.topbtn=this.add.panel(20,180,"md",3,2,20).setText("Tops").onClick((()=>{this.onNavClicked("top")})),this.bottombtn=this.add.panel(20,260,"md",3,2,18).setText("Bottoms").onClick((()=>{this.onNavClicked("bottom")})),this.dump.add(this.add.panel(20,340,"sm",6,2).setText("Background").onClick((()=>{this.sound.play("ui_click");let t=this.gameState.bg+1>this.gameState.bgtotal-1?0:this.gameState.bg+1;this["bg"+(this.gameState.bg+1)].setVisible(!1),this["bg"+(t+1)].setVisible(!0),this.gameState.bg=t})),!0),this.arrowgail=this.add.arrowpanel(20,400,6,"Gail").setVisible(!1).onClick((()=>this.changeChar())),this.arrowmom=this.add.arrowpanel(20,400,6,"Mom","left").setVisible(!1).onClick((()=>this.changeChar())),this.dump.addMultiple([this.add.panel(500,80,"md",3,4).invertColors(),this.add.panel(500,240,"md",3,4).invertColors()],!0),this.add.image(250,248,"bodies","mother"),this.eyes=this.add.image(261,73,"bodies","eyes").setVisible(!1),this.mombottom=this.add.image(248,345,"mombottom",0),this.momtop=this.add.image(240,284,"momtop",0),this.momhair=this.add.image(239,99,"momhair",0),this.abigail=this.add.image(383,258,"bodies","abigail"),this.gailbottom=this.add.image(371,309,"gailbottom",0),this.gailtop=this.add.image(388,261,"gailtop",0),this.gailhair=this.add.image(376,108,"gailhair",0),this.previews={momhairt:this.add.image(555,150,"momhair",0).setScale(.7),momhairb:this.add.image(555,310,"momhair",1).setScale(.7),momtopt:this.add.image(555,200,"momtop",0).setCrop(0,0,216,200).setScale(.6),momtopb:this.add.image(555,360,"momtop",1).setCrop(0,0,216,200).setScale(.6),mombottomt:this.add.image(566,160,"mombottom",0).setScale(.6),mombottomb:this.add.image(566,320,"mombottom",1).setScale(.6),gailhairt:this.add.image(585,170,"gailhair",0).setCrop(0,0,120,150).setScale(.9),gailhairb:this.add.image(585,330,"gailhair",1).setCrop(0,0,120,150).setScale(.9),gailtopt:this.add.image(550,190,"gailtop",0).setCrop(50,0,200,200).setScale(.66),gailtopb:this.add.image(550,350,"gailtop",1).setCrop(50,0,200,200).setScale(.66),gailbottomt:this.add.image(560,170,"gailbottom",0).setScale(.55),gailbottomb:this.add.image(560,330,"gailbottom",1).setScale(.55)},Object.keys(this.previews).forEach((t=>{this.previews[t].setInteractive({cursor:"pointer"}),this.previews[t].setVisible(!1),this.previews[t].on("pointerdown",(()=>this.onPreviewClick(t.endsWith("b")?1:0)))})),this.chooseBtn=this.add.panel(510,270,"sm",5,5).setText("Check Gail's old clothes").setVisible(!1).onClick((()=>{this.speechbox.setName(null);const t=t=>{this.gameState.gail.choice=t,"gail"===this.gameState.currentChar&&"top"===this.gameState.currentSection&&2===this.gameState.gail.toppreview&&(this.chooseBtn.setVisible(!1),this.previews.gailtopb.setFrame("winter"===t?3:4).setVisible(!0)),this.onPreviewClick(1)};this.speechbox.playDialogSequence([{text:"Buried in the pile was something from the past."},{text:"Something that felt like...",options:[{text:"The summer sea",response:[{character:"Gail",text:"You got me this sailor shirt after I told you I'd leave for the sea one day. It used to be so big on me."}],callback:()=>t("summer"),after:"response-continue"},{text:"The winter sea",response:[{character:"Gail",text:"My old wool sweater."},{character:"Gail",text:"You picked the warmest one you could find, even though you never understood why I wanted to be near the sea even in the cold."}],callback:()=>t("winter"),after:"response-continue"}]}])})),this.dump.add(this.add.sprite(530,420,"ui_atlas","arrow-solo").setFlipX(!0).setInteractive({cursor:"pointer"}).on("pointerdown",(()=>this.changePreview("prev"))),!0),this.dump.add(this.add.sprite(590,420,"ui_atlas","arrow-solo").setInteractive({cursor:"pointer"}).on("pointerdown",(()=>this.changePreview("next"))),!0),this.dump.add(this.add.soundbutton(),!0),this.sound.pauseOnBlur=!1,this.music=this.sound.add("music"),this.music.loop=!0,this.music.play(),this.btndone=this.add.panel(280,410,"sm",4,2).setText("done").setVisible(!1).onClick((()=>{this.sound.play("ui_click"),this.speechbox.setName("Gail"),[3,4].includes(this.gameState.gail.top)?this.speechbox.run("This colour doesn't feel appropriate for the occasion"):9!==this.gameState.momtop||2!==this.gameState.mombottom?([this.arrowgail,this.arrowmom,this.hairbtn,this.topbtn,this.bottombtn,this.btndone,this.chooseBtn].forEach((t=>t.destroy())),Object.values(this.previews).forEach((t=>t.destroy())),this.dump.clear(!0,!0),this.time.delayedCall(1e3,(()=>{this.speechbox.run("It seems we're ready.",void 0,(()=>{this.speechbox.run("Just one last thing to do.",void 0,(()=>{[this.abigail,this.gailhair,this.gailtop,this.gailbottom].forEach((t=>t.destroy())),this.initHand()}))}))}))):this.speechbox.run("I don't think mom would have understood this joke")})),this.speechbox=this.add.speechbox(),this.onNavClicked("hair"),this.cameras.main.fadeIn(500,0,0,0)}checkChange(t){s[t].filter((t=>!t.skip)).forEach((e=>{let i;if("preview"===t?this.gameState[e.on[0]][e.on[1]+"preview"]===e.on[2]&&(i=!0):e.on[0]===this.gameState.currentChar&&e.on[1]===this.gameState.currentSection&&this.gameState[e.on[0]][e.on[1]]===e.on[2]&&(i=!0),i){let t=function(t){return String(t).charAt(0).toUpperCase()+String(t).slice(1)};const i=e.text.map((i=>({character:t(e.on[0]),text:i})));this.speechbox.playDialogSequence(i),e.skip=!0}}))}onNavClicked(t){if(this.gameState.currentSection!==t){let e=this.gameState.currentChar;this.gameState.currentSection&&(this.sound.play("ui_click"),this.previews[e+this.gameState.currentSection+"t"].setVisible(!1),this.previews[e+this.gameState.currentSection+"b"].setVisible(!1)),this.previews[e+t+"t"].setVisible(!0),this.previews[e+t+"b"].setVisible(!0);let i="gail"===e&&"top"===t?0:this.gameState[e][t];i%2!=0&&(i-=1),this.gameState[e][t+"preview"]=i,this.previews[e+t+"t"].setFrame(i),this.previews[e+t+"b"].setFrame(i+1),this.gameState.currentSection=t}["hair","top","bottom"].forEach((t=>{this[t+"btn"].invertColors(this.gameState.currentSection===t?"on":"off")})),"gail"===this.gameState.currentChar&&"bottom"===this.gameState.currentSection&&this.btndone.setVisible(!0),this.checkChange("preview")}onPreviewClick(t){this.sound.play("ui_click");const e=this.gameState.currentChar,i=this.gameState.currentSection,s=this.gameState[e][i+"preview"],a="gail"===e&&"top"===i&&2===s&&t?"winter"===this.gameState.gail.choice?3:4:s+t;this[e+i].setFrame(a),this.gameState[e][i]=a,"top"===i&&("gail"===e?(6===a&&0===this.gameState.mom.top||5===a&&8===this.gameState.mom.top)&&(this.gameState.mom.top=1,this.momtop.setFrame(1)):(0===a&&6===this.gameState.gail.top||8===a&&5===this.gameState.gail.top)&&(this.gameState.gail.top=1,this.gailtop.setFrame(1))),this.checkChange("click")}changeChar(){this.sound.play("ui_click"),Object.keys(this.previews).forEach((t=>this.previews[t].setVisible(!1))),this.gameState.currentSection=null,this["arrow"+this.gameState.currentChar].setVisible(!0),this.gameState.currentChar="mom"==this.gameState.currentChar?"gail":"mom",this["arrow"+this.gameState.currentChar].setVisible(!1),this.onNavClicked("hair"),this.checkChange("preview")}initHand(){let t,e=this.gameState.mom;t=[8,9].includes(e.hair)||[3,4,5].includes(e.top)?1:[2,11].includes(e.hair)||[6].includes(e.top)||[[3,6,7].includes(e.hair),[1,2,7,8].includes(e.top),[1,4].includes(e.bottom)].filter(Boolean).length>1?2:1,this.hand=this.add.image(330,65,"bodies","hand").setInteractive({cursor:"pointer"}),this.hand.once("pointerdown",(()=>{this.music.pause(),this.tweens.add({targets:this.hand,x:this.hand.x-50,duration:600}),this.time.delayedCall(1e3,(()=>{this.tweens.add({targets:this.hand,y:this.hand.y+20,duration:400}),this.eyes.visible=!0})),this.time.delayedCall(2e3,(()=>{this.tweens.add({targets:this.hand,x:this.hand.x+50,duration:1e3,onComplete:()=>{this.time.delayedCall(1e3,(()=>this.scene.start("Ending",{seek:this.music.seek,ending:t})))}})}))}))}}class o extends Phaser.GameObjects.Container{constructor(t,e,i,s="md",a,o,h=16){super(t,e,i),this.scene=t,this.type=s,this.tileSize="sm"===s?20:40,this.width=a,this.height=o,this.fontSize=h,this.inverted=!1,this.static=!1,this.init(),t.add.existing(this)}init(){const t=(t,e,i)=>this.add(this.scene.add.image(t,e,"ui_atlas",i).setOrigin(0));let e=this.scene.add.rectangle(this.tileSize,this.tileSize,(this.width-2)*this.tileSize,(this.height-2)*this.tileSize,0).setOrigin(0);this.add(e),this.background=e,t(0,0,`${this.type}-lt`);for(let i=1;i<this.width-1;i++)t(i*this.tileSize,0,`${this.type}-t`);t((this.width-1)*this.tileSize,0,`${this.type}-rt`);for(let i=1;i<this.height-1;i++)t(0,i*this.tileSize,`${this.type}-l`),t((this.width-1)*this.tileSize,i*this.tileSize,`${this.type}-r`);t(0,(this.height-1)*this.tileSize,`${this.type}-lb`);for(let i=1;i<this.width-1;i++)t(i*this.tileSize,(this.height-1)*this.tileSize,`${this.type}-b`);t((this.width-1)*this.tileSize,(this.height-1)*this.tileSize,`${this.type}-rb`)}setText(t){return this.textObject?this.textObject.setText(t):(this.textObject=this.scene.add.text(this.width*this.tileSize/2,this.height*this.tileSize/2,t,{fontSize:`${this.fontSize}px`,color:"#ffffff",align:"center",lineSpacing:2,wordWrap:{width:(this.width-1)*this.tileSize,useAdvancedWrap:!0}}).setOrigin(.5),this.add(this.textObject)),this}onClick(t,e){if(!t)return void this.disableInteractive();this.setInteractive(new Phaser.Geom.Rectangle(0,0,this.width*this.tileSize,this.height*this.tileSize),Phaser.Geom.Rectangle.Contains),this.on("pointerover",(()=>{this.scene.input.setDefaultCursor("pointer"),this.static||this.setPosition(this.x,this.y-2)})),this.on("pointerout",(()=>{this.scene.input.setDefaultCursor("default"),this.static||this.setPosition(this.x,this.y+2)}));const i=()=>{this.scene.sound.play("ui_click"),this.scene.input.setDefaultCursor("default"),t()};return e?this.once("pointerdown",i):this.on("pointerdown",i),this}invertColors(t="toggle"){if(!("on"===t&&this.inverted||"off"===t&&!this.inverted))return this.list.forEach((t=>{t.preFX&&t.preFX.addColorMatrix().negative()})),this.background.setFillStyle(0===this.background.fillColor?16777215:0),this.inverted=!this.inverted,this}setStatic(t){return this.static=t,this}}class h extends Phaser.GameObjects.Container{constructor(t,e=180,i=400,s=14,a=(()=>{})){super(t,e,i),this.scene=t,this.width=s,this.onComplete=a,this.init(),this.scene.load.on("progress",(t=>this.updateProgress(t))),this.scene.load.on("complete",(t=>this.completeLoad(t))),t.add.existing(this)}init(){this.progressBox=this.scene.add.panel(0,0,"sm",this.width,2),this.add(this.progressBox),this.progressBar=this.scene.add.graphics(),this.add(this.progressBar),this.playButton=this.scene.add.panel(10*(this.width-5),0,"sm",5,2).setText("Play"),this.playButton.onClick(this.onComplete),this.playButton.setVisible(!1),this.add(this.playButton)}updateProgress(t){this.progressBar&&t&&this.progressBar.clear().fillStyle(16777215,1).fillRect(13,13,Math.max(0,20*this.width*t-26),16)}completeLoad(){this.progressBox.destroy(),this.progressBar.destroy(),this.playButton.setVisible(!0)}}class n extends Phaser.GameObjects.Sprite{constructor(t,e=600,i=40,s=!0){super(t,e,i,"ui_atlas",s?"sound-on":"sound-off"),this.scene=t,this.setInteractive({cursor:"pointer"}),void 0===n.isSoundOn&&(n.isSoundOn=s),this.updateTexture(),this.on("pointerdown",this.toggleSound,this),this.scene.add.existing(this)}toggleSound(){n.isSoundOn=!n.isSoundOn,this.updateTexture(),this.scene.sound.setMute(!n.isSoundOn)}updateTexture(){this.setTexture("ui_atlas",n.isSoundOn?"sound-on":"sound-off")}}class r extends Phaser.GameObjects.Container{constructor(t,e=15){super(t,20,460),this.scene=t,this.typingSpeed=e,this.options=[],this.currentLines=2,this.maxCharsPerLine=60,this.init(),this.setVisible(!1),t.add.existing(this)}init(){this.overlay=this.scene.add.rectangle(0,0,640,480,0,0).setOrigin(0,0).setInteractive(),this.overlay.setVisible(!1),this.scene.add.existing(this.overlay),this.box=this.scene.add.panel(0,20*-this.currentLines,"sm",30,this.currentLines).setStatic(!0),this.add(this.box),this.textline=this.scene.add.text(20,20*-this.currentLines+12,"",{font:"16px monospace",color:"#ffffff",wordWrap:{width:560,useAdvancedWrap:!0},lineSpacing:2}).setOrigin(0,0),this.add(this.textline),this.nextBtn=this.scene.add.text(580,-18,"▶",{font:"16px monospace",color:"#ffffff"}).setOrigin(1,.5).setVisible(!1),this.add(this.nextBtn)}setName(t){if(this.character=t,this.nameBox&&this.nameBox.destroy(),t){const t=10*Math.max(4,this.character.length);this.nameBox=this.scene.add.panel(0,20*-this.currentLines-40,"sm",Math.ceil(t/20)+2,2).setText(this.character),this.add(this.nameBox)}}updateBoxSize(t){const e=Math.ceil(t.length/this.maxCharsPerLine)+1;e!==this.currentLines&&(this.currentLines=e,this.box.destroy(),this.box=this.scene.add.panel(0,20*-this.currentLines,"sm",30,this.currentLines).setStatic(!0),this.add(this.box),this.textline.setY(20*-this.currentLines+12),this.nameBox&&this.nameBox.setY(20*-this.currentLines-40),this.bringToTop(this.textline),this.bringToTop(this.nextBtn))}playDialogSequence(t,e=(()=>{})){let i=0;const s=()=>{if(i<t.length){const{character:e,text:a,options:o,callback:h}=t[i];i++,e!==this.character&&this.setName(e),h&&h(),this.run(a,o,(t=>{this.handleOption(t,s)}))}else e()};s()}handleOption(t,e){if(t&&t.after)switch(t.after){case"continue":default:e();break;case"break":this.scene.scene.start(t.next);break;case"response-continue":this.playDialogSequence(t.response,e);break;case"response-break":this.playDialogSequence(t.response,(()=>{this.scene.scene.start(t.next)}))}else e()}run(t,e=[],i){this.clearOptions(),this.setVisible(!0),this.overlay.setVisible(!0),this.box.onClick(null),this.textline.setText(""),this.nextBtn.setVisible(!1),this.updateBoxSize(t);let s=0,a="";const o=()=>{s<t.length?(a+=t[s],this.textline.setText(a),s++,this.scene.time.delayedCall(this.typingSpeed,o)):e.length>0?this.showOptions(e,i):(this.nextBtn.setVisible(!0),this.box.onClick((()=>{this.scene.sound.play("ui_click"),this.overlay.setVisible(!1),this.setVisible(!1),i&&i()}),!0))};o()}showOptions(t,e){let i=20*this.currentLines;t.reverse().forEach((({text:t,callback:s,...a},o)=>{const h=Math.max(3,Math.ceil(t.length/2)+2),n=this.scene.add.panel(600-20*h,-40-i,"sm",h,2).setText(t);n.onClick((()=>{this.scene.sound.play("ui_click"),this.clearOptions(),this.overlay.setVisible(!1),this.setVisible(!1),s&&s(),e&&e({text:t,...a})})),this.options.push(n),this.add(n),i+=40}))}clearOptions(){this.options.forEach((t=>t.destroy())),this.options=[]}}class d extends Phaser.GameObjects.Container{constructor(t,e,i,s,a,o="right",h=16){super(t,e,i),this.scene=t,this.width=s,this.text=a,this.direction=o,this.fontSize=h,this.inverted=!1,this.init(),a&&this.addText(),t.add.existing(this)}init(){const t=(t,e,i)=>this.add(this.scene.add.image(t,e,"ui_atlas",i).setOrigin(0));for(let e=1;e<this.width-2;e++){const i="right"===this.direction?e:e+1;t(20*i,0,"sm-t"),t(20*i,20,"sm-b")}"right"===this.direction?(t(0,0,"sm-lt"),t(0,20,"sm-lb"),this.add(this.scene.add.image(20*(this.width-2),0,"ui_atlas","arrow").setOrigin(0))):(t(20*(this.width-1),0,"sm-rt"),t(20*(this.width-1),20,"sm-rb"),this.add(this.scene.add.image(0,0,"ui_atlas","arrow").setFlipX(!0).setOrigin(0)))}addText(){this.add(this.scene.add.text(20*this.width/2,20,this.text,{fontSize:`${this.fontSize}px`,color:"#ffffff",align:"center"}).setOrigin(.5))}onClick(t){if(t)return this.setInteractive(new Phaser.Geom.Rectangle(0,0,20*this.width,40),Phaser.Geom.Rectangle.Contains),this.on("pointerover",(()=>{this.scene.input.setDefaultCursor("pointer"),this.setPosition(this.x,this.y-2)})),this.on("pointerout",(()=>{this.scene.input.setDefaultCursor("default"),this.setPosition(this.x,this.y+2)})),this.on("pointerdown",(()=>{this.scene.sound.play("ui_click"),this.scene.input.setDefaultCursor("default"),t()})),this;this.disableInteractive()}invertColors(t="toggle"){"on"===t&&this.inverted||"off"===t&&!this.inverted||(this.list.forEach((t=>{t.preFX&&t.preFX.addColorMatrix().negative()})),this.inverted=!this.inverted)}}class l extends Phaser.Scene{constructor(t,e="Loading"){super({key:"Boot"}),this.loadingBg=t,this.afterBootScene=e}init(){Phaser.GameObjects.GameObjectFactory.register("panel",(function(...t){const e=new o(this.scene,...t);return this.displayList.add(e),e})),Phaser.GameObjects.GameObjectFactory.register("progressbar",(function(...t){const e=new h(this.scene,...t);return this.displayList.add(e),e})),Phaser.GameObjects.GameObjectFactory.register("speechbox",(function(...t){const e=new r(this.scene,...t);return this.displayList.add(e),e})),Phaser.GameObjects.GameObjectFactory.register("soundbutton",(function(...t){const e=new n(this.scene,...t);return this.displayList.add(e),e})),Phaser.GameObjects.GameObjectFactory.register("arrowpanel",(function(...t){const e=new d(this.scene,...t);return this.displayList.add(e),e}))}preload(){this.load.atlas("ui_atlas","assets/interface/ui.png","assets/interface/ui.json"),this.load.audio("ui_click","assets/interface/lighter.mp3"),this.loadingBg&&this.load.image("loadingBg",this.loadingBg)}create(){this.time.delayedCall(100,(()=>{this.scene.start(this.afterBootScene)}))}}class c extends Phaser.Scene{constructor(t){super({key:t}),this.scenesArray=[]}setScenes(t){this.sound.pauseOnBlur=!1,this.scenesArray=t,this.nextIndex=0,this.scenesArray.forEach((t=>{this[t.bgKey]=this.add.sprite(640,480,t.bgKey).setVisible(!1).setPosition(320,240)})),this.nextArrow=this.add.image(620,460,"ui_atlas","arrow-solo").setOrigin(1).setVisible(!1).setInteractive({cursor:"pointer"}),this.speechbox=this.add.speechbox(),this.add.soundbutton(),this.continue()}onEnd(t){this.endCallback=t}continue(){if(this.nextIndex===this.scenesArray.length&&this.endCallback)return void this.endCallback();this.nextArrow.setVisible(!1);const t=this.scenesArray[this.nextIndex];this.scenesArray.forEach(((t,e)=>{this[t.bgKey].setVisible(e===this.nextIndex)})),this.time.delayedCall(t.delay||1e3,(()=>{t.dialog&&t.dialog.length?this.speechbox.playDialogSequence(t.dialog,(()=>{this.time.delayedCall(500,(()=>{this.continue()}))})):(this.nextArrow.setVisible(!0),this.nextArrow.once("pointerdown",(()=>{this.sound.play("ui_click"),this.continue()})))})),this[t.bgKey].setVisible(!0),this.nextIndex++}}new e.Game({type:e.AUTO,width:640,height:480,parent:"container",backgroundColor:"0x000",dom:{createContainer:!0},scene:[new l("assets/scenes/cut1.png"),i,class extends c{constructor(){super("Intro")}create(){this.aggrolighter=this.sound.add("aggrolighter"),this.zippo=this.sound.add("zippo"),this.sea=this.sound.add("sea",{volume:.75}),this.sea.loop=!0,this.sea.play(),this.setScenes([{bgKey:"loadingBg"},{bgKey:"cut2",dialog:[{text:"The sea breeze is sharp, and the lighter won't catch."},{text:"Try flicking it again?",options:[{text:"Flick aggressively",callback:()=>this.time.delayedCall(500,(()=>this.aggrolighter.play())),after:"response-continue",response:[{text:"Still nothing. Stubborn piece of shit."}]},{text:"Flick dramatically",after:"response-continue",response:[{text:"Still nothing. What a tragic failure."}]}]}]},{bgKey:"cut3",dialog:[{character:"Gail",text:"Oh, fucking wonderful."},{text:"See if someone on the ferry has a lighter?",options:[{text:"Ask a nearby smoker",after:"response-continue",response:[{text:"Gail approaches a smoker."},{text:"The lighter is in her hand before she can ask."}]},{text:"Avoid unnecessary interaction",after:"response-continue",response:[{text:"Gail stays quiet and avoids eye contact."},{text:"A smoker nearby sighs and passes her his lighter."}]}]}]},{bgKey:"cut4",dialog:[{character:"Gail",text:"...",options:[{text:"Thanks."},{text:"..."}],callback:()=>this.zippo.play(),after:"continue"},{character:"Smoker",text:"..."},{character:"Smoker",text:"Huh... You look really familiar. Do I know you?",options:[{text:"...",after:"response-continue",response:[{character:"Smoker",text:"Ah yes, AAA's kiddie, right?"}]},{text:"I don't think so.",after:"response-continue",response:[{character:"Smoker",text:"Nah, I recognize that face. AAA's kiddie, right?"}]},{text:"Maybe. I grew up here.",after:"response-continue",response:[{character:"Smoker",text:"Thought so. You look just like her."}]}]}]},{bgKey:"cut5",dialog:[{character:"Gail",text:"..."},{character:"Smoker",text:"Damn. Bet she's just dying to see you."},{character:"Gail",text:"...",options:[{text:"..."},{text:"Yeah, she'd love that."},{text:"Mhm. She'll be speechless."}]},{text:"..."}]},{delay:2e3,dialog:[{text:"Fifteen minutes from the dock, and here she is."},{character:"Gail",text:"Alright, I'm here! God, that was a long trip."},{character:"Gail",text:"Just need a minute to rest."},{text:"No resting, Gail. We need to get ready!",options:[{text:"Alright, let's begin."},{text:"Ugh. Fine."}]}]}]),this.onEnd((()=>{this.cameras.main.fadeOut(500,0,0,0),this.time.delayedCall(500,(()=>{this.scene.start("Main")}))})),this.events.on("shutdown",(()=>this.sea.stop()))}},a,class extends c{constructor(){super("Ending")}init({ending:t,seek:e}){const i=s["end"+t].map((t=>({text:t})));this.setScenes([{dialog:[{text:`While Abigaïl was sorting through old things and getting ready for the ceremony, she found ${1===this.ending?"a":"an old"} photograph with a handwritten note on the back.`}]},{bgKey:"end"+t,dialog:i},{delay:2e3,dialog:[{character:"Morry",text:"Thanks for playing <3"},{text:"credits credits credits"}]}]),this.music=this.sound.add("music"),this.music.loop=!0,this.music.play({seek:e})}create(){this.add.soundbutton(),this.cameras.main.fadeIn(500,0,0,0),this.onEnd((()=>{this.cameras.main.fadeOut(500,0,0,0),this.time.delayedCall(500,(()=>{this.music.stop(),this.scene.start("Loading")}))}))}}]});
